import { databaseConnect, uniqueID } from './database_utlilites.mjs';

export async function postTags(tagName, UUID, KEY) {
  const db = await databaseConnect;
  if (await uniqueID('Tags', 'tag_name', tagName)) {
    // if this tag doesnt exist
    await db.run('INSERT INTO Tags VALUES (?)', [tagName]);
    // make it
  }
  KEY === 'playlist'
    ? await postTagPlaylist(tagName, UUID)
    : await postTagActivity(tagName, UUID);
  // attach the id of the playlist or activitiy
}
async function postTagPlaylist(tagName, UUID) {
  const db = await databaseConnect;
  await db.run('DELETE FROM PlaylistTagRelation WHERE playlist_id = ?', [UUID]);
  await db.run('INSERT INTO PlaylistTagRelation VALUES (?,?)', [tagName, UUID]);
}

async function postTagActivity(tagName, UUID) {
  const db = await databaseConnect;
  await db.run('DELETE FROM ActivityTagRelation WHERE activity_id = ?', [UUID]);
  await db.run('INSERT INTO ActivityTagRelation VALUES (?,?)', [tagName, UUID]);
}

export async function deleteTag(tagName) {
  const db = await databaseConnect;
  await db.run('DELETE FROM ActivityTagRelation WHERE tagName = ?', [tagName]);
  await db.run('DELETE FROM PlaylistTagRelation WHERE tagName = ?', [tagName]);
  await db.run('DELETE FROM Tags WHERE tag_name = ?', [tagName]);
}

export async function getTagPlaylist(tagName, UUID) {
  // get all tags assocaited with playlist
  const db = await databaseConnect;
  return await db.all(
    'SELECT * FROM PlaylistTagRelation WHERE playlist_id = ?',
    [UUID],
  );
}

export async function getTagActivity(tagName, UUID) {
  // get all tags assocaited with playlist
  const db = await databaseConnect;
  return await db.all(
    'SELECT * FROM ActivityTagRelation WHERE activitiy_id = ?',
    [UUID],
  );
}
